<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.zhangjia.mall.mapper.UserMapper">

    <select id="query" resultType="map">

        SELECT * FROM users
        <where>
            users.user_status = 1
            <if test="userId != null">
                AND user_id = #{userId}
            </if>
            <if test="userName != null">
                AND user_name = #{userName}
            </if>
            <if test="userPassword != null">
                AND user_password = #{userPassword}
            </if>

            <if test="userPayPassword != null">
                AND user_pay_password = #{userPayPassword}
            </if>

        </where>

    </select>

    <insert id="doInsert" parameterType="map" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO users ( user_name, user_password, user_tel, user_mail, user_nick)

         VALUES(#{userName},#{userPassword},
        <if test="userTel != null">
            #{userTel},null,
        </if>
        <if test="userMail != null">
           null,#{userMail},
        </if>

        <if test="userMail == null and userTel == null">
            null,null,
        </if>
        #{userName})
    </insert>

    <select id="isPayPasswordEmpty" resultType="map" >
        SELECT * FROM  users WHERE user_id = #{userId} AND user_pay_password IS NOT NULL
    </select>



    <update id="updateUserInfo" parameterType="map">
    UPDATE users
    <set>
        <if test="user_password != null">
            user_password = #{user_password},
        </if>
        <if test="user_pay_password != null">
            user_pay_password = #{user_pay_password},
        </if>
        <if test="user_tel != null">
            user_tel = #{user_tel},
        </if>
        <if test="user_mail != null">
            user_mail = #{user_mail},
        </if>
        <if test="user_nick != null">
            user_nick = #{user_nick},
        </if>
        <if test="user_gender != null">
            user_gender = #{user_gender},
        </if>
        <if test="user_birthday != null">
            user_birthday = #{user_birthday},
        </if>
        <if test="user_exp != null">
            user_exp = #{user_exp},
        </if>
        <if test="user_status != null">
            user_status = #{user_status}
        </if>
    </set>
    WHERE user_id = #{user_id}
    </update>

</mapper>